<blockquote>
  <p>Artigo originalmente postado em: <a href="https://blog.cienciahacker.ch/gnupg/">https://blog.cienciahacker.ch/gnupg/</a></p>
</blockquote>

<h2 class="no_toc" id="ndice">Índice</h2>

<ul id="markdown-toc">
  <li><a href="#introduo" id="markdown-toc-introduo">Introdução</a>    <ul>
      <li><a href="#openpgp" id="markdown-toc-openpgp">OpenPGP</a></li>
    </ul>
  </li>
  <li><a href="#instalao" id="markdown-toc-instalao">Instalação</a></li>
  <li><a href="#uso" id="markdown-toc-uso">Uso</a>    <ul>
      <li><a href="#encriptao-com-frase" id="markdown-toc-encriptao-com-frase">Encriptação com Frase</a></li>
      <li><a href="#gerando-chaves" id="markdown-toc-gerando-chaves">Gerando Chaves</a>        <ul>
          <li><a href="#adicionando-mais-informaes-s-chaves" id="markdown-toc-adicionando-mais-informaes-s-chaves">Adicionando Mais Informações às Chaves</a></li>
        </ul>
      </li>
      <li><a href="#gerenciando-o-chaveiro" id="markdown-toc-gerenciando-o-chaveiro">Gerenciando o Chaveiro</a>        <ul>
          <li><a href="#exportandoimportando-chaves" id="markdown-toc-exportandoimportando-chaves">Exportando/Importando Chaves</a>            <ul>
              <li><a href="#exportando" id="markdown-toc-exportando">Exportando</a></li>
              <li><a href="#importando" id="markdown-toc-importando">Importando</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#encriptando-arquivos-com-chaves" id="markdown-toc-encriptando-arquivos-com-chaves">Encriptando Arquivos com Chaves</a></li>
      <li><a href="#decriptando-arquivos-com-chaves" id="markdown-toc-decriptando-arquivos-com-chaves">Decriptando Arquivos com Chaves</a></li>
      <li><a href="#utilizando-servidores" id="markdown-toc-utilizando-servidores">Utilizando Servidores</a>        <ul>
          <li><a href="#enviando-chaves" id="markdown-toc-enviando-chaves">Enviando Chaves</a></li>
          <li><a href="#baixando-chaves" id="markdown-toc-baixando-chaves">Baixando Chaves</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#concluso" id="markdown-toc-concluso">Conclusão</a></li>
  <li><a href="#referncias" id="markdown-toc-referncias">Referências</a></li>
</ul>

<h2 id="introduo">Introdução</h2>

<p>Gnu Privacy Guard [0] - ou GnuPG, ou mais reduzido ainda, GPG - é uma implementação do protocolo de cifragem de mensagens OpenPGP.</p>

<p>Em uma vídeo aula [1], disponibilizada no canal Ciência Hacker, foi mostrado o uso do GPG. Aqui vai um artigo para introduzir o conceito e utilização dele ao leitor.</p>

<h3 id="openpgp">OpenPGP</h3>

<p>OpenPGP é um protocolo muito utilizado, previamente, para criptografia de e-mails. Baseado no PGP [2], surgiu, dando ao mundo um método forte e “simples” de criptografia. Utiliza chaves públicas (assimétricas - recomendo a leitura desse artigo [3] para melhor entender o contexto) como engenharia de sua encriptação e define formatos para gerar mensagens encriptadas, assinaturas em arquivos, certificados e demais…</p>

<p>Aqui [4] pode ser encontrado o site do OpenPGP e há também um episódio do podcast Segurança Legal que fala sobre ele, pode ser acessado por aqui [5].</p>

<h2 id="instalao">Instalação</h2>

<p>Sendo breve nessa parte. GnuPG vem por padrão na maioria (senão todos) os sistemas *nix. Mas, caso precise, vai alguns comandos que podem ser úteis:</p>

<ul>
  <li>Arch: <code class="highlighter-rouge">sudo pacman -S gnupg --noconfirm</code></li>
  <li>CentOS: <code class="highlighter-rouge">sudo yum install gnupg -y</code></li>
  <li>Debian: <code class="highlighter-rouge">sudo apt-get install gnupg -y</code></li>
</ul>

<p>Ou, caso precise, pode acessar a página de download no site do projeto [6].</p>

<h2 id="uso">Uso</h2>

<p>O uso do GPG se abrange bastante! Pode ser utilizado deste clientes de e-mail à troca de arquivos. Ele trabalha não só, mas também com o uso do conceito de chaves públicas e privadas. Ou seja, podemos gerar um par de chaves em que a privada fica sob nossa proteção e a pública nós disponibilizamos para o pessoal. Quando quiserem falar comigo, utilizam da chave pública para encriptar os dados e portanto, somente eu poderei ler. Quando eu quiser assinar algo com minha chave, poderão ver pelo fingerprint, por exemplo, que realmente fui eu quem o fiz.</p>

<p>É até comum ver pessoas passando o código de fingerprint de sua chave em páginas de contato, por exemplo, para que possam ter um nível de confiança maior.</p>

<p>Mas como dito, ele não trabalha apenas com o uso dessa chaves. Você pode criar uma frase de segurança com algum amigo e utilizá-la para criptografar dados com ela. Vamos ver isso em nosso primeiro caso. Posteriormente, abordaremos a geração do par de chaves e seu uso.</p>

<h3 id="encriptao-com-frase">Encriptação com Frase</h3>

<p>Para isso, basta ter o programa instalado e rodar o comando:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg -c file
</code></pre>
</div>

<p>Em que o <code class="highlighter-rouge">file</code> é o arquivo que deseja encriptar.</p>

<p>Vai ser pedida a frase de segurança. Não preciso nem comentar sobre a utilização de caracteres especiais e senhas realmente fortes para isso, certo?! Após o processo será gerado um arquivo com extenção <code class="highlighter-rouge">.gpg</code>, que é o já protegido com a frase.</p>

<p>A opção <code class="highlighter-rouge">-c</code> abordada apenas indica ao GPG para que use apenas de criptografia simétrica no processo, sem a necessidade das chaves.</p>

<p>Para ter o arquivo limpo para ser lido, basta usar:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg file.gpg
</code></pre>
</div>

<p>Caso deseje, pode fazer utilizando a opção <code class="highlighter-rouge">-d</code>, mas essa opção apenas irá exibir o conteúdo do arquivo na tela e não criar um novo arquivo livre para ser lido. No caso de uma mídia (imagem, vídeo…) ou um binário em si, talvez não seja tão interessante.</p>

<p>Bem, no mais, isso já ajuda bastante. Em trocas de arquivos, almeje ao menos por utilizar esse processo.</p>

<h3 id="gerando-chaves">Gerando Chaves</h3>

<p>Vamos começar a melhorar o uso do GPG. Como foi dito, ele utiliza a questã de chaves pública/privada para vir à tona sua criptografia assimétrica (caso não saiba do que se trata, recomendo novamente que leia o artigo indicado [3]). Então, vamos lá!</p>

<p>O GPG cria um chaveiro que é onde você poderá gerenciar as chaves que você precisa. Ou seja, basta inserir a chave pública de alguém em seu chaveiro, e quando for precisar para encriptar/decriptar algum dado, poderá indicar de quem é e voilà!</p>

<p>Vamos, num primeiro momento apenas criar nosso par de chaves. Para isso basta utilizar o comando:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --gen-key
</code></pre>
</div>

<p>Primeiramente será perguntado sobre o tipo de chave que queira usar. Já é informado no próprio menu que DSA e RSA é usado apenas para assinatura e há outras duas opções: RSA (e RSA) e DSA (e Elgamal). Por padrão, a primeira opção é marcada. Manteremos ela.</p>

<p>Logo após vem a pergunta sobre o temanho da chaves RSA, que pode ser de 1024 até 4096 bits. 1024 já é um tamanho legal, mas comparado às opções, a mais fraca. 4096 por outro lado seria a mais segura, porém mais demorada. O programa indica utilizar 2048, vamos aceitar também a sugestão.</p>

<p>Depois ele questiona sobre o tempo de validade da chave. 0 significa que a chave não deve expirar. Qualquer número representa os dias de validade. O número seguido de w, m ou y indica semanas, meses ou anos, respectivamente. Como podemos mudar a “frase senha” (mais para frente), podemos numa boa utilizar 0.</p>

<p>Após, basta fornecer algumas informações, como nome, endereço de e-mail e um comentário. Depois desse procedimento é pedido uma “frase senha”. Bom investir em segurança nela, usando os conceitos de uma boa senha.</p>

<p>Feito isso, sua chave já está sendo gerada. Ele precisa de alguns dados “rândomicos” para fazer isso de forma mais elegante. Como sugestão, o programa pede para que façamos alguma atividade como digitar no teclado, mexer o mouse ou utilizar o disco. Você pode fazer como quiser qualquer um desses, apenas forneça o que lhe é pedido.</p>

<h4 id="adicionando-mais-informaes-s-chaves">Adicionando Mais Informações às Chaves</h4>

<p>Caso você tenha mais de um endereço de e-mail que utilize, é uma boa prática colocá-lo também como identificador à sua chave. Para isso, basta inserirmos esse novo identificador.</p>

<p>Para editar a chave, você precisará do comando:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --edit-key &lt;id&gt;
</code></pre>
</div>

<p>Esse ID representa algo que identifique a chave que quer alterar. Pode pegar algumas informações da saída do comando: <code class="highlighter-rouge">gpg --list-keys</code>.</p>

<p>Após entrar no prompt do GPG pode utilizar de comandos como <code class="highlighter-rouge">?</code> ou <code class="highlighter-rouge">help</code> para exibir um menu de ajuda e não ficar tão perdido num primeiro contato.</p>

<p>Utilizando o comando <code class="highlighter-rouge">adduid</code> você poderá inserir o novo endereço de e-mail, apelido ou o que quer que seja. Terminado esse passo, use o comando <code class="highlighter-rouge">save</code> para salvar as alterações e sair do prompt.</p>

<p>Se você já tiver enviado sua chave para um servidor sem essa nova informação basta reenviar e será atualizado. Esse passo de mandar para um servidor será visto mais adiante.</p>

<h3 id="gerenciando-o-chaveiro">Gerenciando o Chaveiro</h3>

<p>O chaveiro, como já foi dito,  é algo criado pelo GPG para armazenar as chaves que você adiciona. Vamos ver agora um pouco do uso do chaveiro.</p>

<p>Você poderá listar as chaves que tem com o seguinte comando:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --list-keys
</code></pre>
</div>

<p>Caso queira ver as chaves privadas, basta utilizar:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --list-secret-key
</code></pre>
</div>

<p>Normalmente aqui só é mostrada uma chave privada, a sua, ou então de grupos que utilize assim.</p>

<h4 id="exportandoimportando-chaves">Exportando/Importando Chaves</h4>

<p>Caso queira exportar para encaminhar para algum contato, utilizar num cliente de e-mail, de chat,  ou enviar para um servidor (caso precise ser dessa forma), vamos ver como ocorre.</p>

<h5 id="exportando">Exportando</h5>

<p>Tenha em mente que para qualquer processo nesse passo precisaremos de um identificador da chave. Para pegar essa informação, liste as chaves que tem e pegue uma informação única à elas.</p>

<p>O comando básico para exportar uma chave é o <code class="highlighter-rouge">--export</code>. Ele irá mostrar a chave como ela realmente é, em formato binário e tal. Caso queira ver em formato ascii, utilize a opção <code class="highlighter-rouge">-a</code>. Para salvar num arquivo, pode utilizar redirecionadores ou então a opção <code class="highlighter-rouge">--output</code>. Vamos ver alguns exemplos do mostrado até então:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --export -a &lt;id&gt; &gt; chave.pub.asc
$ gpg --output chave.gpg -a --export &lt;id&gt;
</code></pre>
</div>

<p>Tenha em mente que a saída em modo ascii é o mais utilizado por ai. Portanto, uma boa opção ter exportado nesse formato.</p>

<p>Para exportar a chave privada, a única coisa que muda é que no lugar de <code class="highlighter-rouge">--export-key</code> será utilizado <code class="highlighter-rouge">--export-secret-key</code>.</p>

<p>Exportando sua chave primária, é bom guardá-la em local seguro! Pois sua chave pública você terá em keyservers (caso utilize esse artigo até o final), já a privada não.</p>

<h5 id="importando">Importando</h5>

<p>Para importar uma chave é simples, basta utilizar:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --import key.gpg
</code></pre>
</div>

<blockquote>
  <p>OBS: O programa não faz distinção de chave pública ou privada na importação. Ou melhor, não exige que você especifique.</p>
</blockquote>

<p>Após importar, deve-se assinar para mostrar a autênticidade da chave. Utilize o comando:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --sign-key &lt;id&gt;
</code></pre>
</div>

<p>Em que `` equivale ao código da chave mostrado. Por exemplo BC71CF75.</p>

<p>Esse código você pode confirmar, por exemplo, telefonando para o dono da chave, conversando pessoalmente, vendo se ele realmente afirma que essa chave é dele em seu site, anyway.</p>

<h3 id="encriptando-arquivos-com-chaves">Encriptando Arquivos com Chaves</h3>

<p>Tendo em mente (ou no clipboard haha) alguma identificação para a chave que deseja utilizar, basta utilizar:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --encrypt arquivo
</code></pre>
</div>

<p>Pode utiilizar ou não o <code class="highlighter-rouge">--output</code>, é à moda do freguês.</p>

<p>Após esse comando será pedido alguma informação que identifique a chave que deseja utilizar. Coloque então o e-mail, nome, ID ou algo dessa natureza para selecionar a chave correta.</p>

<h3 id="decriptando-arquivos-com-chaves">Decriptando Arquivos com Chaves</h3>

<p>Para decriptar é bem simples. Pode-se utilizar o <code class="highlighter-rouge">--output</code> ou não, fique a vontade:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --decrypt arquivo
</code></pre>
</div>

<p>Note que não é necessário especificar a chave pois a ideia é que você possua em seu chaveiro. Caso não seja encontrada, um aviso é mostrado na tela, e poderá utilizar o ID da chave para baixar dos servidores ou buscar em outro lugar.</p>

<h3 id="utilizando-servidores">Utilizando Servidores</h3>

<p>Key server utilizam do protocolo HKP (HTTP Keyserver Protocol), que seria uma adaptação do HTTP para uso com o transporte de chaves.</p>

<p>Há vários servidores espalhados por ai, basta você escolher o que quer fazer uso. Por exemplo, o servidor do próprio projeto PGP [7] ou GnuPG [8]. Muitos desses servidores, após receber uma nova chave, replica para parceiros, assim, mantendo sempre a possibilidade de ter todas as chaves online. Ou seja, muito provável que após enviar para o servidor do GnuPG, em instantes esteja no do PGP também, ou do MIT e assim por diante.</p>

<p>Para utilizar um servidor em específico basta utilizar o parâmetro <code class="highlighter-rouge">--keyserver</code> e passar o servidor como argumento. Por exemplo:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --keyserver hkp://keys.gnupg.net:11371 --search-keys gjuniioor
</code></pre>
</div>

<p>A porta 11371 é padrão nesse tipo de servidor, mas nada impede o administrador de mudar caso necessite.</p>

<blockquote>
  <p>OBS: O parâmetro <code class="highlighter-rouge">--search-keys</code> será melhor abordado mais para frente.</p>
</blockquote>

<h4 id="enviando-chaves">Enviando Chaves</h4>

<p>Então, para poder passar de forma fácil sua chave para amigos e contatos é bacana que você envie para um servidor. É bem simples o processo:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --send-key &lt;id&gt;
</code></pre>
</div>

<blockquote>
  <p>O ID é a identificação da chave, aquele código, como BC71CF75 que já foi abordado aqui.</p>
</blockquote>

<p>Note que nem foi preciso indicar um servidor, a aplicação utiliza por padrão o servidor do GnuPG.</p>

<p>Há alguns servidores que dispõem de uma interface web para fazer buscas ou enviar as chaves, como o do PGP por exemplo. Basta utilizar o protocolo http e não hkp em si, na mesma porta, que ele responde.</p>

<h4 id="baixando-chaves">Baixando Chaves</h4>

<p>Agora, para importar a chave de alguém que esteja em determinado servidor é bem simples. Basta saber alguma informação que seu contato tenha usado no cadastro da chave, por exemplo, nome, e-mail, comentário, apelido ou o próprio ID da chave (como disse, é comum que disponham-as em websites pessoais). Após isso, basta utilizar o comando:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gpg --keyserver hkp://subkeys.pgp.net:11371 --search-keys gjuniioor
</code></pre>
</div>

<p>Isso vai procurar minha chave (pois bem, já pode criptografar as coisas caso queira falar comigo, nem que seja para teste, para ver se entendeu bem o conceito e tudo mais).</p>

<p>Será mostrada uma lista com as chaves que foi encontrada e uma numeração à esquerda representando, nesse momento, a identificação da chave. Note que há um prompt do GPG esperando pelo seu comando. Se colocar o número da chave, irá adicionar ao seu chaveiro. Se inserir <code class="highlighter-rouge">Q</code> vai sair do GPG.</p>

<h2 id="concluso">Conclusão</h2>

<p>Vimos nesse artigo a utilização do cliente por linha de comando. Mas há vários softwares GUI feitos com o objetivo de simplificar o uso total do GnuPG, basta uma simples busca e irá encontrar algumas opções. Não vou indicar nenhum aqui pois nunca os utilizei, sempre preferi CLI mesmo.</p>

<p>Após tudo que foi aprendido nesse artigo, é bom saber o fluxo comum de uso do GPG caso não tenha ficado claro:</p>

<ol>
  <li>Envia sua chave pública para as pessoas. Elas utilizarão dela para criptografar os dados para apenas você poder ler após utilizar sua chave privada.</li>
  <li>Pega a chave pública das pessoas e criptografa a informação com ela, para apenas essa pessoa ter acesso com sua chave privada.</li>
</ol>

<p>Pode ser utilizado também no caso de grupos, em que um integrante criptografa algo com a chave pública desse grupo e todos (e apenas) que tem a chave privada poderão ter acesso.</p>

<p>É extremamente importante manter suas informações seguras! O risco físico (que pode ocorrer caso perca o celular ou tenha o notebook roubado) é pequeno quando comparado aos prejuízos abstratos, como leitura de e-mails ou divultação de seus nudes.</p>

<p>Não fique pensando que o que está aqui é tudo! Há muito mais a ser abordado. Abaixo há mais links para te dar uma trilha de estudos a seguir… E no mais, rodar um <code class="highlighter-rouge">man gpg</code> funciona muito bem! Se divirta! ;)</p>

<h2 id="referncias">Referências</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>[0] - https://gnupg.org/
[1] - https://www.youtube.com/watch?v=XjkEXpv37Nw
[2] - http://www.pgpi.org/
[3] - http://eofcommunity.com/forum/viewtopic.php?f=33&amp;t=1265
[4] - http://www.openpgp.org/
[5] - http://www.segurancalegal.com/2015/03/episodio-71-openpgp.html
[6] - https://www.gnupg.org/download/
[7] - hkp://subkeys.pgp.net:11371
[8] - hkp://keys.gnupg.net:11371
</code></pre>
</div>
